# V1.1 — NIR Data Entry UI Implementation Plan

## Current State Assessment

### Already Built (Reusable)
- **`components/NIRTechnicianInputForm.tsx`** (915 lines) — Complete multi-step form with property info, environmental data, moisture readings, affected areas, scope items, photos. BUT: **orphaned** — not imported anywhere.
- **All API routes** — `/api/inspections/`, environmental, moisture, affected-areas, scope-items, photos, classification, submit — all functional.
- **`InspectionReportViewer.tsx`** — Multi-format report viewer with PDF/Excel export.
- **`RestorationInspectionReportViewer.tsx`** — Professional structured report display.
- **Classification engine** — IICRC S500 auto-classification.
- **Scope determination** — Auto scope items from classification.
- **Cost estimation** — Auto cost calc from scope.
- **Prisma models** — All 13 inspection-related models defined.

### What's Missing
1. No `/dashboard/inspections/` page (no listing page)
2. No navigation entry for "Inspections" in sidebar
3. `NIRTechnicianInputForm` is not mounted in any page
4. No inspection detail/results view page
5. No visual moisture mapping component
6. No pre-submission summary/review step

---

## Implementation Steps

### Step 1: Add Inspections to Sidebar Navigation
**File**: `app/dashboard/layout.tsx`
**Change**: Add nav item after "Reports":
```tsx
{ icon: ClipboardCheck, label: "Inspections", href: "/dashboard/inspections", locked: isTrial }
```
Import `ClipboardCheck` from lucide-react.

### Step 2: Create Inspections Listing Page
**File**: `app/dashboard/inspections/page.tsx` (NEW)
**Pattern**: Mirror `reports/page.tsx` structure (search, filter, pagination, status badges).
**Features**:
- Fetch inspections via `GET /api/inspections`
- Filter by status (DRAFT, SUBMITTED, PROCESSING, COMPLETED, etc.)
- Search by property address, inspection number
- Status badges with color coding per `InspectionStatus` enum
- "New Inspection" button → `/dashboard/inspections/new`
- Click row → `/dashboard/inspections/[id]`
- Display: inspectionNumber, propertyAddress, status, technicianName, createdAt

### Step 3: Create New Inspection Page
**File**: `app/dashboard/inspections/new/page.tsx` (NEW)
**Action**: Mount `NIRTechnicianInputForm` component.
- Credit check before allowing creation (same pattern as reports/new)
- On complete callback → redirect to `/dashboard/inspections/[id]`
- Pass no `reportId` for standalone inspections

### Step 4: Create Inspection Detail Page
**File**: `app/dashboard/inspections/[id]/page.tsx` (NEW)
**Features**:
- Fetch inspection with all relations via `GET /api/inspections?id={id}` (may need a new endpoint: `GET /api/inspections/[id]`)
- Tab-based layout:
  - **Overview** — Status, property info, timeline (submitted → classified → scoped → estimated → completed)
  - **Environmental** — Temperature, humidity, dew point display
  - **Moisture Readings** — Table of all readings with location, surface type, level, depth
  - **Affected Areas** — Cards showing room/zone, square footage, water source, category/class
  - **Classification** — IICRC category + class with justification and standard reference
  - **Scope Items** — Checklist of determined items with justification
  - **Cost Estimate** — Table with line items, quantities, rates, totals
  - **Photos** — Gallery grid with thumbnails
- Actions: Edit (if DRAFT), Generate PDF, Export Excel, Link to Report
- Status progress bar (DRAFT → SUBMITTED → PROCESSING → CLASSIFIED → SCOPED → ESTIMATED → COMPLETED)

### Step 5: Add GET Inspection by ID API Route
**File**: `app/api/inspections/[id]/route.ts` (NEW)
**Action**: Create GET endpoint that returns full inspection with all relations:
```ts
include: {
  environmentalData: true,
  moistureReadings: true,
  affectedAreas: true,
  scopeItems: true,
  classifications: true,
  costEstimates: true,
  photos: true,
  auditLogs: true
}
```

### Step 6: Visual Moisture Mapping Component
**File**: `components/inspection/MoistureMappingCanvas.tsx` (NEW)
**Features**:
- Canvas-based component using HTML5 Canvas or SVG
- Upload floor plan image as background (or simple rectangle placeholder)
- Click to place moisture reading points
- Each point shows: location label, moisture %, color-coded (green < 20%, yellow 20-40%, red > 40%)
- Color gradient heatmap overlay
- Click point to expand reading details
- Export as PNG for PDF inclusion
- Mobile-friendly touch support

### Step 7: Wire Moisture Mapping into Detail Page
**File**: `app/dashboard/inspections/[id]/page.tsx`
**Action**: Add "Moisture Map" tab that renders `MoistureMappingCanvas` with inspection's moisture readings pre-loaded.

### Step 8: Add Inspections List API Enhancement
**File**: `app/api/inspections/route.ts`
**Action**: Enhance existing GET to support:
- Pagination (`page`, `limit` params)
- Search (`search` param for address/inspection number)
- Status filter (`status` param)
- Sort (`sortBy`, `sortOrder` params)

---

## File Summary

| File | Action | Size Estimate |
|------|--------|--------------|
| `app/dashboard/layout.tsx` | EDIT — add nav item | Small |
| `app/dashboard/inspections/page.tsx` | NEW — listing page | ~300 lines |
| `app/dashboard/inspections/new/page.tsx` | NEW — mount form | ~80 lines |
| `app/dashboard/inspections/[id]/page.tsx` | NEW — detail view with tabs | ~500 lines |
| `app/api/inspections/[id]/route.ts` | NEW — GET by ID | ~60 lines |
| `app/api/inspections/route.ts` | EDIT — pagination/search | ~40 lines added |
| `components/inspection/MoistureMappingCanvas.tsx` | NEW — visual mapping | ~300 lines |

**Total**: 4 new files, 2 edits, ~1,280 lines

---

## Open Questions
1. Should standalone inspections (not linked to reports) be supported, or always linked?
2. Should the moisture mapping use a simple image upload for floor plans, or a basic drawing tool?
3. Is the existing `NIRTechnicianInputForm` flow (multi-step with submit) sufficient, or does it need a separate review/confirm step before submission?
